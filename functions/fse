#!/usr/bin/env nu
# fse - Forge file Search ‚Üí Editor
# Universal knowledge file discovery with editor opening
# Part of nushell-knowledge-tools v2.0

def main [] {
    if not ($env.FORGE? | is-empty) and ($env.FORGE | path exists) {
        let file = (fd . $env.FORGE --type f --extension md | ^env TERM=xterm-256color TERMINFO="" TERMINFO_DIRS="" sk --preview 'bat --color=always {}' --preview-window 'right:60%' --bind 'up:up,down:down,ctrl-j:down,ctrl-k:up' --prompt "üìù File Search: " | str trim)
        if not ($file | is-empty) {
            # Use $env.EDITOR with graceful fallback
            let editor = if (not ($env.EDITOR? | is-empty)) {
                $env.EDITOR
            } else {
                "vi"
            }

            print $"üöÄ Opening ($file | path basename) in ($editor)..."
            ^$editor $file
        }
    } else {
        print "‚ùå FORGE not set or doesn't exist"
        print "üí° Set with: $env.FORGE = '/path/to/your/knowledge-base'"
    }
}
