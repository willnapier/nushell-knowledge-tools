#!/usr/bin/env nu
# gco - Global Content search â†’ Open
# Universal content discovery with system-appropriate opening
# Part of nushell-knowledge-tools v2.0

def main [] {
    let query = (input "ğŸ” Search content: ")
    if ($query | is-empty) {
        return
    }

    print $"ğŸ” Searching for: ($query)"
    let results = try {
        ^rg -i -l $query . | lines | where $it != ""
    } catch {
        print "âŒ Content search failed. Install ripgrep: brew install ripgrep"
        return
    }

    if ($results | is-empty) {
        print "âŒ No matches found"
        return
    }

    let selected = ($results | str join "\n" | ^env TERM=xterm-256color TERMINFO="" TERMINFO_DIRS="" sk --preview $"rg --color=always -i -C 3 '($query)' {}" --preview-window 'right:60%' --bind 'up:up,down:down,ctrl-j:down,ctrl-k:up' --prompt "ğŸ“„ Content: " | str trim)
    if not ($selected | is-empty) {
        print $"ğŸš€ Opening ($selected | path basename) with system default..."

        # Use platform-appropriate open command
        if (sys host | get name) == "Darwin" {
            ^open $selected
        } else {
            ^xdg-open $selected
        }
    }
}
